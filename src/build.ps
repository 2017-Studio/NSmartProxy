rem NSP v0.3
set Ver=v0.3
set BuildPath=%~dp0/../build

set nsp_server_path=%BuildPath%/nspclient_%Ver%
set nsp_client_path=%BuildPath%/nspserver_%Ver%
set nsp_client_winfform_path=%BuildPath%/nspclient_winform_%Ver%

del %~dp0/../build/*.*
rem NSPClient
dotnet publish .\NSmartProxyClient\NSmartProxyClient.csproj -o %nsp_server_path%

rem NSPServer
dotnet publish .\NSmartProxy.ServerHost\NSmartProxy.ServerHost.csproj -o %nsp_client_path%

rem NSPWinform
MSBuild .\NSmartProxyWinform\NSmartProxyWinform.csproj /t:build /p:OutDir=%nsp_client_winfform_path%
del %nsp_client_winfform_path%/*.pdb
del %nsp_client_winfform_path%/*.xml

rem ilmerge
rem ruined :<

rem compress
Compress-Archive -Path '%nsp_server_path%/*.*' -DestinationPath '%BuildPath%/nspclient_%Ver%.zip' -Force 
Compress-Archive -Path '%nsp_client_path%/*.*' -DestinationPath '%BuildPath%/nspserver_%Ver%.zip' -Force 
Compress-Archive -Path '%nsp_client_winfform_path%/*.*' -DestinationPath '%BuildPath%/nspclient_winform_%Ver%.zip' -Force 
